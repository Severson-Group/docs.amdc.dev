<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta property="article:modified_time" content="2025-01-02T16:59:04-06:00" /><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Control with AMDC" href="../../control-with-amdc/index.html" /><link rel="prev" title="Math Benchmarks" href="../math-benchmarks/math-benchmarks.html" />
        <link rel="canonical" href="https://docs.amdc.dev/getting-started/user-guide/amds-interface/index.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.png"/><!-- Generated with Sphinx 6.2.1 and Furo 2024.08.06 -->
        <title>AMDS Interface - AMDC Platform</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=04c057b233f3c8d71940eee6080f658a04e2027d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=cf727022eb7470bc603c08d2e55c3247faec75c9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">AMDC Platform</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">AMDC Platform</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GitHub Repositories</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Hardware">AMDC-Hardware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Firmware">AMDC-Firmware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../onboarding.html">Onboarding</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/meet-amdc/index.html">Meet the AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/blink/index.html">Blink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/hw-commands/index.html">Hardware Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/vsi/index.html">Voltage Source Inverter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/profiling-tasks/index.html">Profiling Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/timing-manager/index.html">Timing &amp; Sensors</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../advanced-tutorials/index.html">Advanced Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Advanced Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-tutorials/custom-control-rate/index.html">Custom Control Rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-tutorials/fpga-ip-core/index.html">Custom FPGA IP Core</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../host-interface/index.html">Host Interface</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Host Interface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../host-interface/python-wrapper.html">Python Wrapper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../logging/index.html">Signal Logging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Signal Logging</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../logging/buffered.html">Buffered</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/streaming.html">Streaming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../injection/index.html">Signal Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../task-profiling.html">Task Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math-benchmarks/math-benchmarks.html">Math Benchmarks</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">AMDS Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../control-with-amdc/index.html">Control with AMDC</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Control with AMDC</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../control-with-amdc/current-sensor-cal/index.html">Current Sensor Calibration</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/index.html">Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/obtaining-hardware.html">Obtaining Hardware</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../hardware/subsystems/index.html">Subsystems</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Subsystems</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/picozed.html">PicoZed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/analog.html">Analog Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/encoder.html">Encoder Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/power-distribution.html">Power Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/power-stack.html">Power Stack Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/expansion-port.html">Expansion Port</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../hardware/revisions/index.html">PCB Revisions</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of PCB Revisions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/revisions/firmware-upgrades-per-hardware-target.html">Firmware Upgrades Per Hardware Target</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-d/index.html">REV D Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of REV D Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-bring-up.html">REV D Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-errata.html">REV D Errata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-pin-mapping.html">REV D Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-e/index.html">REV E Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of REV E Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-e/rev-e-bring-up.html">REV E Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-e/rev-e-pin-mapping.html">REV E Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-f/index.html">REV F Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of REV F Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-f/rev-f-bring-up.html">REV F Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-f/rev-f-pin-mapping.html">REV F Pin Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firmware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware/index.html">Firmware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware/development/index.html">Development</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../firmware/arch/index.html">Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Architecture</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../firmware/arch/drivers/index.html">Drivers</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Drivers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/gpio-mux.html">GPIO Port Mux Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/status-mux.html">Inverter Status Mux Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/encoder.html">Encoder Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/eddy-current-sensor.html">Eddy Current Sensor Driver</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/system.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/timing-manager.html">Timing Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/user-apps.html">User Apps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../firmware/xilinx-tools/index.html">Xilinx Tools</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Xilinx Tools</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/installing-xilinx-tools.html">Installing Xilinx Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/building-and-running-firmware.html">Building and Running Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/flashing.html">Flashing AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/create-private-repo.html">Create Private Repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/create-user-app.html">Create Custom User App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/dual-core.html">Dual Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/low-level-debugging.html">Low-Level Debugging</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Accessories</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/amds/index.html">AMDS</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of AMDS</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/amds-in-action/index.html">AMDS in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/firmware/index.html">Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/mainboard/index.html">Mainboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../accessories/amds/sensor-cards/index.html">Sensor Cards</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Sensor Cards</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/high-voltage/index.html">High Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/low-voltage/index.html">Low Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/current/index.html">Current</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/uinverter/index.html">μInverter</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of μInverter</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/hardware-design.html">Hardware Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/connections.html">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/rl-est/index.html">RL Estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/dac/index.html">DAC</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of DAC</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/dac/pcb-electrical-tests.html">PCB Electrical Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../accessories/test-board/index.html">TestBoard</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/Severson-Group/docs.amdc.dev/blob/main/source/getting-started/user-guide/amds-interface/index.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/Severson-Group/docs.amdc.dev/edit/main/source/getting-started/user-guide/amds-interface/index.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="amds-interface">
<h1>AMDS Interface<a class="headerlink" href="#amds-interface" title="Permalink to this heading">¶</a></h1>
<p>This document describes the built-in AMDC drivers which can be used to interface with the AMDS.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Before attempting to use these drivers, make sure to read about the AMDS in <a class="reference internal" href="../../../accessories/amds/index.html"><span class="std std-doc">its documentation</span></a>.</p>
</div>
<section id="amds-firmware-version">
<h2>AMDS Firmware Version<a class="headerlink" href="#amds-firmware-version" title="Permalink to this heading">¶</a></h2>
<p>Ensure that your AMDS firmware version matches your AMDC firmware version using the following table:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>AMDC Version</p></th>
<th class="head"><p>AMDS Version</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>v1.3.x or greater</p></td>
<td><p>v2.x.x</p></td>
</tr>
<tr class="row-odd"><td><p>v1.2.x or lesser</p></td>
<td><p>v1.x.x</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="configure-amds-hardware">
<h2>Configure AMDS Hardware<a class="headerlink" href="#configure-amds-hardware" title="Permalink to this heading">¶</a></h2>
<p>First, the AMDS hardware needs to be configured:</p>
<ol class="arabic simple">
<li><p>Supply 24V power to the AMDS via the screw terminals (LEDs should illuminate)</p></li>
<li><p>Install the four jumpers which select “daisy-chain” operation of the sensor cards. The daisy-chain mode is marked as <code class="docutils literal notranslate"><span class="pre">D</span></code> on the silkscreen.</p></li>
<li><p>Install the sensor cards. Since each SPI input is configured as daisy-chain, you need to populate the lower-number sensor cards before the higher, i.e., install 1 before 5. If you do not install the lower-number sensor card, the second sensor card in the daisy chain will not work.</p></li>
</ol>
<p>Now that the hardware is configured, the AMDC firmware must be configured.</p>
</section>
<section id="include-amds-code-and-configure-amdc-gpio-port">
<h2>Include AMDS Code and Configure AMDC GPIO Port<a class="headerlink" href="#include-amds-code-and-configure-amdc-gpio-port" title="Permalink to this heading">¶</a></h2>
<p>By default, the AMDS drivers are not compiled into the C-code.</p>
<p>To enable, update the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file and set the following define to <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_ENABLE_AMDS_SUPPORT (1)</span>
</pre></div>
</div>
<p>Since the AMDS can be plugged into any of the GPIO ports, the AMDS driver inside the AMDC needs to be connected to the desired AMDC GPIO Port via the <a class="reference internal" href="../../../firmware/arch/drivers/gpio-mux.html"><span class="doc std std-doc">GPIO Mux</span></a> interface. This configuration can be done via the Command Line Interface, or using functions in the C code:</p>
<section id="command-line-interface">
<h3>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this heading">¶</a></h3>
<p>Once the above <code class="docutils literal notranslate"><span class="pre">#define</span></code> is declared, the hardware will enable an AMDS interface app, this will show up as a set of <code class="docutils literal notranslate"><span class="pre">amds</span></code> commands at bootup. To enable AMDS usage in this app, we need to first route the mux to the appropriate ports. This is done through the <code class="docutils literal notranslate"><span class="pre">hw</span> <span class="pre">mux</span> <span class="pre">gpio</span> <span class="pre">&lt;port&gt;</span> <span class="pre">&lt;device&gt;</span></code> command call.</p>
<section id="amdc-rev-d">
<h4>AMDC REV D<a class="headerlink" href="#amdc-rev-d" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">1-2</span></code> – for REV D hardware utilizing this command interface, the AMDS should be connected to the top #1 port.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;device&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">2</span></code> for the AMDS connection</p></li>
</ul>
<p>Once the <code class="docutils literal notranslate"><span class="pre">gpio_mux</span></code> is routed, we can now make inquiries to the AMDS for data. This is done through the <code class="docutils literal notranslate"><span class="pre">amds</span> <span class="pre">&lt;port&gt;</span> <span class="pre">XXXX</span></code> command structure described in the <code class="docutils literal notranslate"><span class="pre">help</span></code> interface. Note that <code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">1</span></code> for the top #1 port.</p>
</section>
<section id="amdc-rev-e-and-beyond">
<h4>AMDC REV E and beyond<a class="headerlink" href="#amdc-rev-e-and-beyond" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">1-4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;device&gt;</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">1</span></code> for the AMDS connection</p></li>
</ul>
<p>Once the <code class="docutils literal notranslate"><span class="pre">gp3io_mux</span></code> is routed, we can now make inquiries to the AMDS for data. This is done through the <code class="docutils literal notranslate"><span class="pre">amds</span> <span class="pre">&lt;port&gt;</span> <span class="pre">XXXX</span></code> command structure described in the <code class="docutils literal notranslate"><span class="pre">help</span></code> interface. Note that <code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> ranges from <code class="docutils literal notranslate"><span class="pre">1-4</span></code> and should correspond to the GPIO port number your AMDS is connected to.</p>
</section>
</section>
<section id="configure-gpio-gp3io-mux-in-code">
<h3>Configure GPIO/GP3IO Mux in Code<a class="headerlink" href="#configure-gpio-gp3io-mux-in-code" title="Permalink to this heading">¶</a></h3>
<section id="id1">
<h4>AMDC REV D<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h4>
<p>Use the <code class="docutils literal notranslate"><span class="pre">gpio_mux</span></code> FPGA IP block to configure the routing path.</p>
<p>Place the header file in the custom user app .c file</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drv/gpio_mux.h&quot;</span>
</pre></div>
</div>
<p>Place the code below into your custom user app init function. Modify the first variable in the function call to match the physical port connection joining the AMDC with the AMDS. Note this is zero-indexed and the GPIO port per the silk screen is one-indexed.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Configure GPIO mux for the AMDS</span>
<span class="c1">// 0: top port on AMDC</span>
<span class="c1">// 1: bot port on AMDC</span>
<span class="c1">// GPIO_MUX_DEVICE1: Eddy Current Sensor IP block</span>
<span class="c1">// GPIO_MUX_DEVICE2: AMDS driver IP block</span>
<span class="n">gpio_mux_set_device</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_MUX_DEVICE2</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id2">
<h4>AMDC REV E and beyond<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h4>
<p>Similar process as above, except the file and function call are now <code class="docutils literal notranslate"><span class="pre">gp3io</span></code>, and the <code class="docutils literal notranslate"><span class="pre">_DEVICE#</span></code> has swapped.</p>
<p>Include the header file in the custom user app .c file</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drv/gp3io_mux.h&quot;</span>
</pre></div>
</div>
<p>Place the code below into your custom user app init function. Modify the <code class="docutils literal notranslate"><span class="pre">GP3IO_MUX_#_BASE_ADDR</span></code> define to match the physical port connection joining the AMDC with the AMDS.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Configure GP3IO mux for the AMDS</span>
<span class="c1">// GP3IO_MUX_#_BASE_ADDR means AMDC GPIO Port #</span>
<span class="c1">// GP3IO_MUX_DEVICE1 is AMDS driver IP block</span>
<span class="c1">// GP3IO_MUX_DEVICE2 is Eddy Current Sensor IP block</span>
<span class="n">gp3io_mux_set_device</span><span class="p">(</span><span class="n">GP3IO_MUX_1_BASE_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">GP3IO_MUX_DEVICE1</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="enabling-the-amds-in-the-timing-manager">
<h2>Enabling the AMDS in the Timing Manager<a class="headerlink" href="#enabling-the-amds-in-the-timing-manager" title="Permalink to this heading">¶</a></h2>
<p>Triggering data acquisition on the AMDS is done via the AMDC <a class="reference internal" href="../../../firmware/arch/timing-manager.html"><span class="std std-doc">Timing Manager</span></a>. The Timing Manager triggers sensors to sample data aligned with the peaks and/or valleys of the PWM carrier, or at a sub-rate of these events. Run the command <code class="docutils literal notranslate"><span class="pre">hw</span> <span class="pre">tm</span> <span class="pre">enable</span> <span class="pre">amds</span> <span class="pre">#</span></code>, or include the following function in your user app init function:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Enable data sampling for AMDS on GPIO Port #</span>
<span class="n">timing_manager_enable_sensor</span><span class="p">(</span><span class="n">AMDS_1</span><span class="p">);</span>
</pre></div>
</div>
<p>To learn more about how to enable sensors and how to configure triggering, please follow the <a class="reference internal" href="../../tutorials/timing-manager/index.html"><span class="std std-doc">Timing &amp; Sensors tutorial</span></a>.</p>
</section>
<section id="requesting-and-retrieving-data-from-the-amds">
<h2>Requesting and Retrieving Data from the AMDS<a class="headerlink" href="#requesting-and-retrieving-data-from-the-amds" title="Permalink to this heading">¶</a></h2>
<p>After the AMDS is triggered to begin sampling, each sensor card populated on the AMDS will sample and provide the data the processor on the mainboard. As soon as the mainboard has collected all the data from the sensor cards, the mainboard will automatically send all the data back to the AMDC, where the data for each sensor card will be made available in the corresponding channel’s data register. To learn more about the firmware interface between the AMDC and AMDS please see the <a class="reference internal" href="../../../accessories/amds/firmware/index.html"><span class="std std-doc">AMDS Firmware documentation</span></a>, and the AMDC driver code in the <a class="reference external" href="https://github.com/Severson-Group/AMDC-Firmware">AMDC-Firmware repository</a>. The FPGA code can be found in <code class="docutils literal notranslate"><span class="pre">ip_repo/amdc_amds_1.0</span></code>, and C code can be found in <code class="docutils literal notranslate"><span class="pre">sdk/app_cpu1/common/drv/amds.c</span></code>.</p>
</section>
<section id="use-sampled-data">
<h2>Use Sampled Data<a class="headerlink" href="#use-sampled-data" title="Permalink to this heading">¶</a></h2>
<p>After the data has been transmitted back to the AMDC from the AMDS, it can be used by the user application.
User code can read the raw 16-bit signed integer value as sampled on the AMDS sensor cards by using the following driver:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">amds_channel_e</span><span class="w"> </span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">get_data()</span></code> is <strong>non-blocking</strong> – it will return the latest data that the AMDS sent, but will not trigger new data to be sent. This matches how the integrated ADCs work on the AMDC.</p>
<p><strong>NOTE</strong>: The AMDS driver will make <em>all</em> data received from the mainboard available, even if the data became corrupted during transmission back to the AMDC.</p>
<p>Therefore, the user should also make use of the <code class="docutils literal notranslate"><span class="pre">check_data_validity()</span></code> function to verify that the data returned by <code class="docutils literal notranslate"><span class="pre">get_data()</span></code> was not corrupted during transmission. This function will return a byte (eight bits) where each bit represents the data validity for one of the eight channels on the AMDS. If this function returns 255, that implies that all channels returned valid data:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">amds_check_data_validity</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">port</span><span class="p">)</span>
</pre></div>
</div>
<p>To check the validity of all eight channels’ data, consider using the following code in a task callback:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">task_callback</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">amds_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">out_ch_1</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_2</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_3</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">out_ch_5</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_6</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_7</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Check validity of latest data for the AMDS plugged into your GPIO port</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_check_data_validity</span><span class="p">(</span><span class="n">amds_port</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">valid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Yay! 0xFF means the bits for all channels are valid!</span>
<span class="w">        </span><span class="c1">// Read in values sampled on the AMDS (plugged into your GPIO port) from all channels:</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_1</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_2</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_3</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_4</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_5</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_5</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_6</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_6</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_7</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_7</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_8</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Now, &quot;out&quot; variables contain the sign-extended 16-bit</span>
<span class="w">        </span><span class="c1">// sample value for each channel</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Else, you decide what to do if there was invalid data this cycle</span>

<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To check the validity of only certain channels’ data, consider the following instead:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">task_callback</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">amds_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">out_ch_1</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_3</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_5</span><span class="p">,</span><span class="w"> </span><span class="n">out_ch_6</span><span class="p">;</span>

<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">my_channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AMDS_CH_1_VALID_MASK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AMDS_CH_3_VALID_MASK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AMDS_CH_5_VALID_MASK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AMDS_CH_6_VALID_MASK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Check validity of latest data for the AMDS plugged into your GPIO port</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_check_data_validity</span><span class="p">(</span><span class="n">amds_port</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">valid</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">my_channels</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">my_channels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Yay! Valid check matched</span>
<span class="w">        </span><span class="c1">// Read in values sampled on the AMDS (plugged into your GPIO port) from your channels:</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_1</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_3</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_5</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_5</span><span class="p">);</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amds_get_data</span><span class="p">(</span><span class="n">amds_port</span><span class="p">,</span><span class="w"> </span><span class="n">AMDS_CH_6</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out_ch_6</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Now, &quot;out&quot; variables contain the sign-extended 16-bit</span>
<span class="w">        </span><span class="c1">// sample value for each channel</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Else, you decide what to do if there was invalid data this cycle</span>

<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading">¶</a></h2>
<p>The AMDS-AMDC digital interface sometimes needs debugging if valid data does not appear from the AMDC drivers.</p>
<section id="trigger-a-single-transmission">
<h3>Trigger a Single Transmission<a class="headerlink" href="#trigger-a-single-transmission" title="Permalink to this heading">¶</a></h3>
<p><em>In the following commands, replace <code class="docutils literal notranslate"><span class="pre">1</span></code> with the GPIO port number of your AMDS board.</em></p>
<ol class="arabic simple">
<li><p>Turn off automatic sensor triggering by switching the Timing Manager mode: <code class="docutils literal notranslate"><span class="pre">hw</span> <span class="pre">tm</span> <span class="pre">mode</span> <span class="pre">MANUAL</span></code></p></li>
<li><p>Instruct the timing manager to send a single sensor trigger on the next PWM carrier peak/valley: <code class="docutils literal notranslate"><span class="pre">hw</span> <span class="pre">tm</span> <span class="pre">send_trigger</span></code></p></li>
<li><p>Print the validity of the new sample data: <code class="docutils literal notranslate"><span class="pre">amds</span> <span class="pre">1</span> <span class="pre">valid</span></code></p></li>
<li><p>Print the received sample data to the terminal: <code class="docutils literal notranslate"><span class="pre">amds</span> <span class="pre">1</span> <span class="pre">data</span></code></p></li>
</ol>
<p>The process above allows for scope-level debugging since you are manually triggering everything to happen.</p>
</section>
<section id="amds-driver-debug-counters">
<h3>AMDS Driver Debug Counters<a class="headerlink" href="#amds-driver-debug-counters" title="Permalink to this heading">¶</a></h3>
<p>The AMDC uses a FPGA IP block for the AMDS interface driver.
It keeps track of the performance of the digital link to the AMDS via several counters in the FPGA.
For each byte of data transmitted from the AMDS to AMDC, one counter is incremented within the FPGA driver.</p>
<p>At any time, you can read the counters via: <code class="docutils literal notranslate"><span class="pre">amds</span> <span class="pre">1</span> <span class="pre">counters</span></code> (or, programmatically via the associated C code API)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Valid</span></code> means a full byte of data was received is passed the parity check.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Corrupt</span></code> means a full data byte was received, but the UART parity check failed (typically due to noise, EMI, etc).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">bytes</span></code> is a timeout when the AMDC expected a byte from the AMDS, but it never showed up. Since this count is for a single data byte, it will typically only increment by a small amount when unplugging the cable connecting the AMDC and AMDS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> is a timeout for a full four-packet (12 byte) data stream. This counter will increment when the AMDC is requesting data from the AMDS but gets <em>nothing</em> back, which happens continuously when the cable connecting the AMDC and AMDS is fully unplugged.</p></li>
</ul>
<p>If all the counters are stuck at zero, the mostly likely cause is that the AMDS is not enabled in the timing manager. If only the <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> counter is incrementing, the AMDS is either unplugged, or the GPIO mux configuration was not completed correctly. If the connection is made correctly and active, the value of the <code class="docutils literal notranslate"><span class="pre">Valid</span></code> counter should be continually incrementing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For all counters, since the UART link has two data lines, a separate 16-bit counter is used for each data line.
The <code class="docutils literal notranslate"><span class="pre">counters</span></code> command returns both counters concatenated into a 32-bit value.
For example, if the value is <code class="docutils literal notranslate"><span class="pre">0x0002</span></code> for the first UART data line and <code class="docutils literal notranslate"><span class="pre">0x0003</span></code> for the second UART data line, the counter will appear as: <code class="docutils literal notranslate"><span class="pre">0x00020003</span></code>.</p>
</div>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h4>
<p>Consider running this experiment: the AMDS-AMDC link is working and you are reading valid data. Then, the cable comes unplugged.</p>
<ul class="simple">
<li><p>When the link is working, the <code class="docutils literal notranslate"><span class="pre">Valid</span></code> counter will continuously be incrementing (and wrapping around at the 16-bit limit)</p></li>
<li><p>As the cable comes unplugged, chances are, it will occur during some byte transmission. This will cause some corrupt data bytes and some individual bytes to timeout. The <code class="docutils literal notranslate"><span class="pre">Corrupt</span></code> and <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">bytes</span></code> counters may each increment a few times based on exactly how the cable became unplugged.</p></li>
<li><p>After the cable is fully unplugged, the AMDC views every data stream requested as a data timeout, so the <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> counter will continuously increment. The other counters should remain frozen in their last value.</p></li>
</ul>
<p>This debug counter behaviour can be seen occuring repeatedly in the following video captured during experimental testing. When connected, <code class="docutils literal notranslate"><span class="pre">Valid</span></code> is incrementing, and when disconnected, <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> is incrementing. The <code class="docutils literal notranslate"><span class="pre">Corrupt</span></code> and <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">bytes</span></code> counters increment as the transition is made between the connected and disconnected states.</p>
<p><img alt="" src="../../../_images/debug-counters.gif" /></p>
<p>The image below also shows a graphical capture of the counters incrementing their values.</p>
<a class="reference internal image-reference" href="../../../_images/debug-counter-graph.png"><img alt="Graph showing the values of debug counters during experiment" class="align-left" src="../../../_images/debug-counter-graph.png" style="height: 18em;" /></a>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Upper Graph Legend Name</p></th>
<th class="head"><p>Counter Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span style="color:royalblue;font-weight:bold">V_0</span></p></td>
<td><p>Valid Count - Data Line 0</p></td>
</tr>
<tr class="row-odd"><td><p><span style="color:darkorange;font-weight:bold">V_1</span></p></td>
<td><p>Valid Count - Data Line 1</p></td>
</tr>
<tr class="row-even"><td><p><span style="color:forestgreen;font-weight:bold">D_0</span></p></td>
<td><p>Timed out Data Count - Data Line 0</p></td>
</tr>
<tr class="row-odd"><td><p><span style="color:firebrick;font-weight:bold">D_1</span></p></td>
<td><p>Timed out Data Count - Data Line 1</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can see in the upper graph that the <code class="docutils literal notranslate"><span class="pre">Valid</span></code> counters for both Data Lines 0 and 1 ramp up (and overflow back to zero) while the cable between the AMDC and AMDS is plugged in. At around time 1500, the cable is unplugged. The value of the <code class="docutils literal notranslate"><span class="pre">Valid</span></code> counter freezes, while the value of the <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> counter begins to ramp up. Around time 2200, the cable is plugged back in and the counters switch off, and unplugged again at time 4000.</p>
<p>Around time 6000, the cable is wiggled at the connector, rapidly connecting and disconnecting the two boards, to simulate a cable that is not fully plugged in. During this operating condition, the <code class="docutils literal notranslate"><span class="pre">Valid</span></code> and <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">data</span></code> counters rapidly switch off between ramping and freezing.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Lower Graph Legend Name</p></th>
<th class="head"><p>Counter Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span style="color:royalblue;font-weight:bold">C_0</span></p></td>
<td><p>Corrupt Count - Data Line 0</p></td>
</tr>
<tr class="row-odd"><td><p><span style="color:darkorange;font-weight:bold">C_1</span></p></td>
<td><p>Corrupt Count - Data Line 1</p></td>
</tr>
<tr class="row-even"><td><p><span style="color:forestgreen;font-weight:bold">B_0</span></p></td>
<td><p>Timed out Byte Count - Data Line 0</p></td>
</tr>
<tr class="row-odd"><td><p><span style="color:firebrick;font-weight:bold">B_1</span></p></td>
<td><p>Timed out Byte Count - Data Line 1</p></td>
</tr>
</tbody>
</table>
</div>
<p>In the lower graph, the <code class="docutils literal notranslate"><span class="pre">Corrupt</span></code> and <code class="docutils literal notranslate"><span class="pre">Timed</span> <span class="pre">out</span> <span class="pre">Byte</span></code> counters for both data lines are shown. These counters should not really be increasing constantly during any operation, instead they may jump up a bit each time the cable becomes plugged in or unplugged, as a few individual data packets become corrupted or timeout.</p>
<p>The bytes become corrupted much more frequently when the cable is loosely-connected/jostled after time 6000.</p>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        

        <div class="related-pages">
          <a class="next-page" href="../../control-with-amdc/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Control with AMDC</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../math-benchmarks/math-benchmarks.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Math Benchmarks</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2025, Electric Machinery and Levitation Laboratory
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jan 02, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74WCSDC0D0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-74WCSDC0D0');
</script>

<div class="google-analytics-tracking-info">
This page uses <a href="https://analytics.google.com/">Google Analytics</a> to collect statistics. Disable by blocking JavaScript from www.google-analytics.com.
</div>


      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">AMDS Interface</a><ul>
<li><a class="reference internal" href="#amds-firmware-version">AMDS Firmware Version</a></li>
<li><a class="reference internal" href="#configure-amds-hardware">Configure AMDS Hardware</a></li>
<li><a class="reference internal" href="#include-amds-code-and-configure-amdc-gpio-port">Include AMDS Code and Configure AMDC GPIO Port</a><ul>
<li><a class="reference internal" href="#command-line-interface">Command Line Interface</a><ul>
<li><a class="reference internal" href="#amdc-rev-d">AMDC REV D</a></li>
<li><a class="reference internal" href="#amdc-rev-e-and-beyond">AMDC REV E and beyond</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-gpio-gp3io-mux-in-code">Configure GPIO/GP3IO Mux in Code</a><ul>
<li><a class="reference internal" href="#id1">AMDC REV D</a></li>
<li><a class="reference internal" href="#id2">AMDC REV E and beyond</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-the-amds-in-the-timing-manager">Enabling the AMDS in the Timing Manager</a></li>
<li><a class="reference internal" href="#requesting-and-retrieving-data-from-the-amds">Requesting and Retrieving Data from the AMDS</a></li>
<li><a class="reference internal" href="#use-sampled-data">Use Sampled Data</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a><ul>
<li><a class="reference internal" href="#trigger-a-single-transmission">Trigger a Single Transmission</a></li>
<li><a class="reference internal" href="#amds-driver-debug-counters">AMDS Driver Debug Counters</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    </body>
</html>