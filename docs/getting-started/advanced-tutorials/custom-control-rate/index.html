<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta property="article:modified_time" content="2024-03-27T15:35:22-05:00" /><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Tutorial: Custom FPGA IP Core" href="../fpga-ip-core/index.html" /><link rel="prev" title="Advanced Tutorials" href="../index.html" />
        <link rel="canonical" href="https://docs.amdc.dev/getting-started/advanced-tutorials/custom-control-rate/index.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.png"/><!-- Generated with Sphinx 6.2.1 and Furo 2024.08.06 -->
        <title>Tutorial: Custom Control Rate - AMDC Platform</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=04c057b233f3c8d71940eee6080f658a04e2027d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=cf727022eb7470bc603c08d2e55c3247faec75c9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">AMDC Platform</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">AMDC Platform</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GitHub Repositories</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Hardware">AMDC-Hardware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Severson-Group/AMDC-Firmware">AMDC-Firmware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../onboarding.html">Onboarding</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/meet-amdc/index.html">Meet the AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/blink/index.html">Blink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/hw-commands/index.html">Hardware Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/vsi/index.html">Voltage Source Inverter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/profiling-tasks/index.html">Profiling Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/timing-manager/index.html">Timing &amp; Sensors</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Advanced Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Advanced Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Custom Control Rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga-ip-core/index.html">Custom FPGA IP Core</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user-guide/index.html">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../user-guide/host-interface/index.html">Host Interface</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Host Interface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user-guide/host-interface/python-wrapper.html">Python Wrapper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../user-guide/logging/index.html">Signal Logging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Signal Logging</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user-guide/logging/buffered.html">Buffered</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user-guide/logging/streaming.html">Streaming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guide/injection/index.html">Signal Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guide/task-profiling.html">Task Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guide/math-benchmarks/math-benchmarks.html">Math Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guide/amds-interface/index.html">AMDS Interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../control-with-amdc/index.html">Control with AMDC</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Control with AMDC</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../control-with-amdc/current-sensor-cal/index.html">Current Sensor Calibration</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/index.html">Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/obtaining-hardware.html">Obtaining Hardware</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../hardware/subsystems/index.html">Subsystems</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Subsystems</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/picozed.html">PicoZed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/analog.html">Analog Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/encoder.html">Encoder Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/power-distribution.html">Power Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/power-stack.html">Power Stack Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/subsystems/expansion-port.html">Expansion Port</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../hardware/revisions/index.html">PCB Revisions</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of PCB Revisions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/revisions/firmware-upgrades-per-hardware-target.html">Firmware Upgrades Per Hardware Target</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-d/index.html">REV D Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of REV D Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-bring-up.html">REV D Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-errata.html">REV D Errata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-d/rev-d-pin-mapping.html">REV D Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-e/index.html">REV E Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of REV E Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-e/rev-e-bring-up.html">REV E Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-e/rev-e-pin-mapping.html">REV E Pin Mapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../hardware/revisions/rev-f/index.html">REV F Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of REV F Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-f/rev-f-bring-up.html">REV F Bring-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/revisions/rev-f/rev-f-pin-mapping.html">REV F Pin Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firmware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware/index.html">Firmware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware/development/index.html">Development</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../firmware/arch/index.html">Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Architecture</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../firmware/arch/drivers/index.html">Drivers</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Drivers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/gpio-mux.html">GPIO Port Mux Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/status-mux.html">Inverter Status Mux Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/encoder.html">Encoder Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../firmware/arch/drivers/eddy-current-sensor.html">Eddy Current Sensor Driver</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/system.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/timing-manager.html">Timing Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/arch/user-apps.html">User Apps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../firmware/xilinx-tools/index.html">Xilinx Tools</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Xilinx Tools</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/installing-xilinx-tools.html">Installing Xilinx Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/building-and-running-firmware.html">Building and Running Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/flashing.html">Flashing AMDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/create-private-repo.html">Create Private Repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/create-user-app.html">Create Custom User App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/dual-core.html">Dual Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../firmware/xilinx-tools/low-level-debugging.html">Low-Level Debugging</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Accessories</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/amds/index.html">AMDS</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of AMDS</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/amds-in-action/index.html">AMDS in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/firmware/index.html">Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/amds/mainboard/index.html">Mainboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../accessories/amds/sensor-cards/index.html">Sensor Cards</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Sensor Cards</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/high-voltage/index.html">High Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/low-voltage/index.html">Low Voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../accessories/amds/sensor-cards/current/index.html">Current</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/uinverter/index.html">μInverter</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of μInverter</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/hardware-design.html">Hardware Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/connections.html">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/uinverter/rl-est/index.html">RL Estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../accessories/dac/index.html">DAC</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of DAC</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../accessories/dac/pcb-electrical-tests.html">PCB Electrical Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../accessories/test-board/index.html">TestBoard</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/Severson-Group/docs.amdc.dev/blob/main/source/getting-started/advanced-tutorials/custom-control-rate/index.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/Severson-Group/docs.amdc.dev/edit/main/source/getting-started/advanced-tutorials/custom-control-rate/index.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="tutorial-custom-control-rate">
<h1>Tutorial: Custom Control Rate<a class="headerlink" href="#tutorial-custom-control-rate" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><strong>Goal:</strong> Run control tasks at any desired rate.</p></li>
<li><p><strong>Complexity:</strong> 3 / 5</p></li>
<li><p><strong>Estimated Time:</strong> 30 min</p></li>
</ul>
<p>This tutorial explains the best approach for configuring the AMDC <code class="docutils literal notranslate"><span class="pre">v1.0</span></code> firmware to run user control tasks at any given rate.
Nuances of the firmware architecture are discussed which impact control code execution.</p>
<section id="tutorial-requirements">
<h2>Tutorial Requirements<a class="headerlink" href="#tutorial-requirements" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Working AMDC hardware</p></li>
<li><p>Completion of the <a class="reference internal" href="../../tutorials/vsi/index.html"><span class="std std-doc">VSI tutorial</span></a></p></li>
<li><p>Review of the <code class="docutils literal notranslate"><span class="pre">v1.0</span></code> firmware <a class="reference internal" href="../../../firmware/arch/system.html"><span class="doc std std-doc">system architecture documentation</span></a></p></li>
<li><p>Review of the <a class="reference internal" href="../../user-guide/logging/index.html"><span class="doc std std-doc">signal logging framework</span></a> built-in to the AMDC</p></li>
</ol>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">¶</a></h2>
<p>The AMDC <code class="docutils literal notranslate"><span class="pre">v1.0</span></code> firmware uses a simple <strong>time triggered cooperative (TTC) scheduler</strong> that has no task preemption.
Read more about the system firmware design <a class="reference internal" href="../../../firmware/arch/system.html"><span class="doc std std-doc">here</span></a>.
The key implication of this architectural decision is that care must be taken to ensure control code runs as desired: no jitter, no over-runs, and at the desired rate.</p>
<p>By default, the firmware uses a 10 kHz scheduler time quantum, meaning all tasks running on the system must complete within 100 us.
If a task takes too long, the system “overruns” which introduces significant jitter in the task execution timing.
Therefore, users must configure the AMDC firmware for the best chance of zero overruns and very little timing jitter.
The remainder of this document explains how to do this.</p>
</section>
<section id="verification-of-timing">
<h2>Verification of Timing<a class="headerlink" href="#verification-of-timing" title="Permalink to this heading">¶</a></h2>
<p>The most important part of running real-time control code is knowing if it indeed is running as expected.
Therefore, during all hardware testing, it is highly advised to <strong>always</strong> be measuring and logging the execution timing data for the control task.
Recall that the averaged task timing data can be recorded and viewed using the built-in system task timing statistics framework which is presented in the <a class="reference internal" href="../../tutorials/profiling-tasks/index.html"><span class="doc std std-doc">profiling tasks tutorial</span></a>.
However, data per each task execution is more useful for timing verification.</p>
<p>To record fine grain timing data, instrument your code task callback function as shown below.
This uses the <code class="docutils literal notranslate"><span class="pre">drv/cpu_timer</span></code> module for ultra-high-precision timing: on-chip timer with 1.5 ns resolution and small access latency.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drv/cpu_timer.h&quot;</span>

<span class="c1">// ...</span>

<span class="kt">double</span><span class="w"> </span><span class="n">LOG_control_looptime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">double</span><span class="w"> </span><span class="n">LOG_control_runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">last_now_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">task_control_callback</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Compute and log the loop time for this task</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">now_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpu_timer_now</span><span class="p">();</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">looptime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now_start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last_now_start</span><span class="p">;</span>
<span class="w">    </span><span class="n">last_now_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now_start</span><span class="p">;</span>
<span class="w">    </span><span class="n">LOG_control_looptime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpu_timer_ticks_to_usec</span><span class="p">(</span><span class="n">looptime</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// .....</span>
<span class="w">    </span><span class="c1">// Here is where your control code runs</span>
<span class="w">    </span><span class="c1">// .....</span>

<span class="w">    </span><span class="c1">// Compute and log the run time for this task</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">now_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpu_timer_now</span><span class="p">();</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now_end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">now_start</span><span class="p">;</span>
<span class="w">    </span><span class="n">LOG_control_runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpu_timer_ticks_to_usec</span><span class="p">(</span><span class="n">runtime</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After the code has been instrumented, the <a class="reference internal" href="../../user-guide/logging/index.html"><span class="doc std std-doc">Signal Logging framework</span></a> can be used to view the controller task run-time and loop time:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LOG_control_runtime</span></code> – run time in µsec</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOG_control_looptime</span></code> – loop time in µsec</p></li>
</ul>
</section>
<section id="firmware-configuration">
<h2>Firmware Configuration<a class="headerlink" href="#firmware-configuration" title="Permalink to this heading">¶</a></h2>
<p>There are several things to change in the firmware configuration to run the control task at arbitrary rates, for example, 50 kHz, etc.
Even when running at the default 10 kHz, the items below should be completed to ensure the best timing performance of the code.</p>
<p>The following examples assume a 50 kHz control rate, but users are free to use different frequencies.</p>
<section id="update-system-tick-frequency">
<h3>1. Update system tick frequency<a class="headerlink" href="#update-system-tick-frequency" title="Permalink to this heading">¶</a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file, set the desired control rate:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SYS_TICK_FREQ (50000)</span>
</pre></div>
</div>
<p>This sets the entire AMDC firmware tick frequency to the given value, which enables the controller to run that fast as well.</p>
</section>
<section id="update-task-callback-frequency">
<h3>2. Update task callback frequency<a class="headerlink" href="#update-task-callback-frequency" title="Permalink to this heading">¶</a></h3>
<p>Update the header file for the control task and set the callback frequency to 50 kHz.</p>
</section>
<section id="register-controller-task-using-high-priority">
<h3>3. Register controller task using high priority<a class="headerlink" href="#register-controller-task-using-high-priority" title="Permalink to this heading">¶</a></h3>
<p>By default, tasks registered with the scheduler are appended to the end of the task list which gets executed each time slice.
This can introduce large amounts of timing jitter in the control task.</p>
<p>To force the control task to run first during the time quantum, register the task using the high priority API:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">scheduler_tcb_register_high_priority</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcb</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="disable-time-quantum-checking">
<h3>4. Disable time quantum checking<a class="headerlink" href="#disable-time-quantum-checking" title="Permalink to this heading">¶</a></h3>
<p>Since the user will be monitoring the timing performance using the log variables which were configured above, there is no need to force the AMDC firmware to stop execution if any timing overruns occur.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file, disable overrun protection:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_ENABLE_TIME_QUANTUM_CHECKING (0)</span>
</pre></div>
</div>
</section>
<section id="disable-system-task-timing-statistics">
<h3>5. Disable system task timing statistics<a class="headerlink" href="#disable-system-task-timing-statistics" title="Permalink to this heading">¶</a></h3>
<p>Once again, since the user is managing the task profiling using log variables, there is no need for the system to also keep track of the timing.
The system task timing statistics add overhead which is not needed.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">usr/user_config.h</span></code> file, disable system task stats:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_ENABLE_TASK_STATISTICS_BY_DEFAULT (0)</span>
</pre></div>
</div>
</section>
<section id="set-log-memory-to-minimum">
<h3>6. Set log memory to minimum<a class="headerlink" href="#set-log-memory-to-minimum" title="Permalink to this heading">¶</a></h3>
<p>To speed up the logging code, reduce the logging framework memory to the minimum required by the application by shrinking the maximum number of log variables and the sample depth per log variable:</p>
<p>For example, when only logging 4 variables for short durations:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USER_CONFIG_LOGGING_MAX_NUM_VARIABLES (4)</span>
<span class="cp">#define USER_CONFIG_LOGGING_SAMPLE_DEPTH_PER_VARIABLE (1000)</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-system-firmware-changes">
<h2>Advanced System Firmware Changes<a class="headerlink" href="#advanced-system-firmware-changes" title="Permalink to this heading">¶</a></h2>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This section instructs you to update the core AMDC system code.
Only attempt these changes if you are able to revert your code base back to a known working version, i.e., you are appropriately using version control.</p>
</div>
<p>Due to the time triggered cooperative scheduler in the AMDC firmware, there can be needless timing collisions based on the phasing of different tasks.</p>
<p>Consider 10 independent tasks which need to run every second, i.e., 1 Hz, and each takes 5 usec to execute.
This means all 10 tasks require 50 usec of computation time.
If all the tasks run during the same time slice, this could overrun the scheduler for system tick frequencies faster than <span class="math notranslate nohighlight">\(1 / 50~\mu\text{s} = 20~\text{kHz}\)</span>.
The clever reader will realize this overrun could easily be prevented by phase shifting the execution of each task by 1 time slice so that the computational load is split more evenly.</p>
<p>By default, each task has an initial phase shift in timing of 0, meaning the above example is prone to happening. However, the user can update the timing offsets of each task to help reduce the chance of scheduler overruns.</p>
<section id="how-to-update-task-execution-timing-offset">
<h3>How to update task execution timing offset<a class="headerlink" href="#how-to-update-task-execution-timing-offset" title="Permalink to this heading">¶</a></h3>
<p>Each scheduler <code class="docutils literal notranslate"><span class="pre">task_control_block_t</span></code> struct has a field <code class="docutils literal notranslate"><span class="pre">last_run_usec</span></code> which directly maps to the timing offset. To add a timing offset, simply override this field during initialization. The field has units of usec.</p>
<p>For example, to add an offset of 100 usec to the task:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// task_controller.c</span>

<span class="c1">// Scheduler TCB which holds task &quot;context&quot;</span>
<span class="k">static</span><span class="w"> </span><span class="n">task_control_block_t</span><span class="w"> </span><span class="n">tcb</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">task_controller_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scheduler_tcb_is_registered</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcb</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fill TCB with parameters</span>
<span class="w">    </span><span class="n">scheduler_tcb_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcb</span><span class="p">,</span><span class="w"> </span><span class="n">task_controller_callback</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controller&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TASK_CONTROLLER_INTERVAL_USEC</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Override the task timing offset</span>
<span class="w">    </span><span class="n">tcb</span><span class="p">.</span><span class="n">last_run_usec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Register task with scheduler</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">scheduler_tcb_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcb</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">scheduler_tcb_init()</span></code> function resets the <code class="docutils literal notranslate"><span class="pre">last_run_usec</span></code> field to 0, so the user must update the task struct after calling the init function.</p>
</section>
<section id="which-tasks-to-update">
<h3>Which tasks to update<a class="headerlink" href="#which-tasks-to-update" title="Permalink to this heading">¶</a></h3>
<p>Tasks which execute at the system tick frequency should not be updated to add an offset–it makes no sense to update them since they run every time slice no matter what.</p>
<p>All other tasks could be updated to add an execution timing phase shift.</p>
<p>There are numerous system tasks which run on the AMDC in addition to user tasks.
To find all tasks, use the file search feature within the SDK to locate calls to <code class="docutils literal notranslate"><span class="pre">scheduler_tcb_register()</span></code>.</p>
</section>
<section id="good-values-for-the-execution-timing-phase-shifts">
<h3>Good values for the execution timing phase shifts<a class="headerlink" href="#good-values-for-the-execution-timing-phase-shifts" title="Permalink to this heading">¶</a></h3>
<p>For the best spread of computational load, each task should be offset so that it runs in its own time slice.
It can be complicated to find suitable offsets for a system with many tasks which all run at different rates.</p>
<p>Consider a simple example system with <span class="math notranslate nohighlight">\(N\)</span> tasks which all run at interval <span class="math notranslate nohighlight">\(T_{task}\)</span>. The system tick interval <span class="math notranslate nohighlight">\(T_{sys} &lt; \frac{1}{N} T_{task}\)</span> so that it is possible to schedule the tasks with no collisions.
The offset for task <span class="math notranslate nohighlight">\(i\)</span> is denoted <span class="math notranslate nohighlight">\(t_i\)</span> and <span class="math notranslate nohighlight">\(i = 0,~1,~\ldots,~N-1\)</span>.</p>
<p>Then, one offset configuration which eliminates timing collisions is
<span class="math notranslate nohighlight">\(t_i = T_{sys}i\)</span>
which means each task has its own time slice in which to run.</p>
</section>
</section>
<section id="pwm-requirements">
<h2>PWM Requirements<a class="headerlink" href="#pwm-requirements" title="Permalink to this heading">¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">v1.0</span></code> AMDC firmware (which is all that exists today), try to keep the PWM switching frequency greater than 2-5x the control rate.
For example, for a control rate of 10 kHz, try to switch at greater than 20 kHz, preferably &gt;50 kHz.</p>
<p>This is due to issues with the ADC sampling logic in the FPGA which cause samples to be missed, resulting in invalid ADC feedback for a given control time step.
If the control rate is too close to the PWM carrier frequency, multiple of the same sampled value will be returned from the ADC driver.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        

        <div class="related-pages">
          <a class="next-page" href="../fpga-ip-core/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Tutorial: Custom FPGA IP Core</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Advanced Tutorials</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2025, Electric Machinery and Levitation Laboratory
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Mar 27, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74WCSDC0D0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-74WCSDC0D0');
</script>

<div class="google-analytics-tracking-info">
This page uses <a href="https://analytics.google.com/">Google Analytics</a> to collect statistics. Disable by blocking JavaScript from www.google-analytics.com.
</div>


      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tutorial: Custom Control Rate</a><ul>
<li><a class="reference internal" href="#tutorial-requirements">Tutorial Requirements</a></li>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#verification-of-timing">Verification of Timing</a></li>
<li><a class="reference internal" href="#firmware-configuration">Firmware Configuration</a><ul>
<li><a class="reference internal" href="#update-system-tick-frequency">1. Update system tick frequency</a></li>
<li><a class="reference internal" href="#update-task-callback-frequency">2. Update task callback frequency</a></li>
<li><a class="reference internal" href="#register-controller-task-using-high-priority">3. Register controller task using high priority</a></li>
<li><a class="reference internal" href="#disable-time-quantum-checking">4. Disable time quantum checking</a></li>
<li><a class="reference internal" href="#disable-system-task-timing-statistics">5. Disable system task timing statistics</a></li>
<li><a class="reference internal" href="#set-log-memory-to-minimum">6. Set log memory to minimum</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-system-firmware-changes">Advanced System Firmware Changes</a><ul>
<li><a class="reference internal" href="#how-to-update-task-execution-timing-offset">How to update task execution timing offset</a></li>
<li><a class="reference internal" href="#which-tasks-to-update">Which tasks to update</a></li>
<li><a class="reference internal" href="#good-values-for-the-execution-timing-phase-shifts">Good values for the execution timing phase shifts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pwm-requirements">PWM Requirements</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>